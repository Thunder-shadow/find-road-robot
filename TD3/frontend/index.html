<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍎 苹果配送机器人控制系统</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="app-header">
            <div class="header-left">
                <h1><i class="fas fa-robot"></i> 苹果配送机器人控制系统</h1>
            </div>
            <div class="header-center">
                <div class="connection-status">
                    <span id="connection-status" class="status-disconnected">
                        <i class="fas fa-plug"></i> 未连接
                    </span>
                </div>
            </div>
            <div class="header-right">
                <div class="battery-status">
                    <i class="fas fa-battery-full"></i>
                    <span id="battery-level">100%</span>
                </div>
                <button id="system-control" class="btn btn-primary">
                    <i class="fas fa-power-off"></i> 启动系统
                </button>
            </div>
        </header>

        <div class="app-content">
            <!-- 左侧控制面板 -->
            <div class="control-panel">
                <!-- 视觉识别模块 -->
                <div class="control-section">
                    <h3><i class="fas fa-eye"></i> 视觉识别</h3>
                    <div class="image-preview" id="image-preview">
                        <div class="image-placeholder">
                            <i class="fas fa-image"></i>
                            <p>点击选择图像或拖拽图像到此处</p>
                        </div>
                        <img id="preview-image" class="hidden">
                    </div>
                    
                    <div class="button-group">
                        <button id="btn-load-image" class="btn btn-secondary">
                            <i class="fas fa-folder-open"></i> 选择图像
                        </button>
                        <button id="btn-capture" class="btn btn-secondary" disabled>
                            <i class="fas fa-camera"></i> 捕获图像
                        </button>
                        <button id="btn-recognize" class="btn btn-primary">
                            <i class="fas fa-search"></i> 识别苹果
                        </button>
                    </div>
                    
                    <div class="recognition-result">
                        <div class="result-row">
                            <span class="result-label">识别结果:</span>
                            <span id="recognition-result" class="result-value">未识别</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">置信度:</span>
                            <div class="confidence-bar">
                                <div id="confidence-bar" class="confidence-fill"></div>
                                <span id="confidence-text">0%</span>
                            </div>
                        </div>
                        <div class="result-row">
                            <span class="result-label">检测数量:</span>
                            <span id="detection-count" class="result-value">0</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">对应货架:</span>
                            <span id="shelf-info" class="result-value">未知</span>
                        </div>
                    </div>
                </div>

                <!-- 语音控制模块 -->
                <div class="control-section">
                    <h3><i class="fas fa-microphone"></i> 语音控制</h3>
                    <div class="button-group">
                        <button id="btn-start-voice" class="btn btn-success">
                            <i class="fas fa-microphone"></i> 开始语音识别
                        </button>
                        <button id="btn-stop-voice" class="btn btn-danger" disabled>
                            <i class="fas fa-microphone-slash"></i> 停止语音识别
                        </button>
                    </div>
                    
                    <div class="voice-commands">
                        <h4>最近命令:</h4>
                        <div id="voice-commands-list" class="commands-list">
                            <!-- 命令列表将在这里动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 导航控制模块 -->
                <div class="control-section">
                    <h3><i class="fas fa-map-marked-alt"></i> 导航控制</h3>
                    
                    <div class="shelf-selection">
                        <label for="shelf-select">目标货架:</label>
                        <select id="shelf-select" class="form-select">
                            <option value="1号货架">1号货架</option>
                            <option value="2号货架">2号货架</option>
                            <option value="3号货架">3号货架</option>
                            <option value="4号货架">4号货架</option>
                            <option value="5号货架">5号货架</option>
                            <option value="充电站">充电站</option>
                            <option value="起点">起点</option>
                        </select>
                    </div>
                    
                    <div class="navigation-buttons">
                        <button id="btn-go-shelf" class="btn btn-primary">
                            <i class="fas fa-play"></i> 前往货架
                        </button>
                        <button id="btn-return-home" class="btn btn-warning">
                            <i class="fas fa-home"></i> 返回起点
                        </button>
                        <button id="btn-go-charge" class="btn btn-info">
                            <i class="fas fa-charging-station"></i> 前往充电
                        </button>
                        <button id="btn-stop-nav" class="btn btn-danger">
                            <i class="fas fa-stop"></i> 停止导航
                        </button>
                    </div>
                    
                    <div class="navigation-progress">
                        <div class="progress-label">导航进度:</div>
                        <div class="progress-bar">
                            <div id="navigation-progress" class="progress-fill"></div>
                        </div>
                        <span id="progress-text">0%</span>
                    </div>
                </div>
            </div>

            <!-- 右侧主内容区 -->
            <div class="main-content">
                <!-- 标签页导航 -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="status">
                        <i class="fas fa-chart-line"></i> 状态监控
                    </button>
                    <button class="tab-btn" data-tab="map">
                        <i class="fas fa-map"></i> 地图显示
                    </button>
                    <button class="tab-btn" data-tab="training">
                        <i class="fas fa-brain"></i> 训练监控
                    </button>
                    <button class="tab-btn" data-tab="log">
                        <i class="fas fa-clipboard-list"></i> 系统日志
                    </button>
                    <button class="tab-btn" data-tab="settings">
                        <i class="fas fa-cog"></i> 系统设置
                    </button>
                </div>

                <!-- 标签页内容 -->
                <div class="tab-content">
                    <!-- 状态监控标签页 -->
                    <div id="tab-status" class="tab-pane active">
                        <div class="status-grid">
                            <div class="status-card">
                                <h4><i class="fas fa-location-arrow"></i> 位置信息</h4>
                                <div class="status-item">
                                    <span class="item-label">X坐标:</span>
                                    <span id="pos-x" class="item-value">0.00 m</span>
                                </div>
                                <div class="status-item">
                                    <span class="item-label">Y坐标:</span>
                                    <span id="pos-y" class="item-value">0.00 m</span>
                                </div>
                                <div class="status-item">
                                    <span class="item-label">朝向:</span>
                                    <span id="heading" class="item-value">0.00°</span>
                                </div>
                            </div>
                            
                            <div class="status-card">
                                <h4><i class="fas fa-tachometer-alt"></i> 速度信息</h4>
                                <div class="status-item">
                                    <span class="item-label">线速度:</span>
                                    <span id="linear-speed" class="item-value">0.00 m/s</span>
                                </div>
                                <div class="status-item">
                                    <span class="item-label">角速度:</span>
                                    <span id="angular-speed" class="item-value">0.00 rad/s</span>
                                </div>
                            </div>
                            
                            <div class="status-card">
                                <h4><i class="fas fa-exclamation-triangle"></i> 障碍物检测</h4>
                                <div class="status-item">
                                    <span class="item-label">检测数量:</span>
                                    <span id="obstacle-count" class="item-value">0</span>
                                </div>
                            </div>
                            
                            <div class="status-card">
                                <h4><i class="fas fa-cogs"></i> 系统状态</h4>
                                <div class="status-item">
                                    <span class="item-label">当前模式:</span>
                                    <span id="current-mode" class="item-value">空闲</span>
                                </div>
                                <div class="status-item">
                                    <span class="item-label">当前任务:</span>
                                    <span id="current-task" class="item-value">无</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sensor-visualization">
                            <div class="sensor-card">
                                <h4><i class="fas fa-satellite-dish"></i> 激光雷达数据</h4>
                                <canvas id="laser-canvas" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- 地图显示标签页 -->
                    <div id="tab-map" class="tab-pane">
                        <div class="map-container">
                            <canvas id="map-canvas" width="800" height="600"></canvas>
                        </div>
                        <div class="map-controls">
                            <button id="btn-refresh-map" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> 刷新地图
                            </button>
                            <button id="btn-save-map" class="btn btn-secondary">
                                <i class="fas fa-save"></i> 保存地图
                            </button>
                            <div class="zoom-control">
                                <label for="map-zoom">缩放:</label>
                                <input type="range" id="map-zoom" min="50" max="200" value="100">
                                <span id="zoom-value">100%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 训练监控标签页 -->
                    <div id="tab-training" class="tab-pane">
                        <div class="training-controls">
                            <h4><i class="fas fa-play-circle"></i> 训练控制</h4>
                            <div class="training-form">
                                <div class="form-group">
                                    <label for="training-episodes">训练回合:</label>
                                    <input type="number" id="training-episodes" min="1" max="1000" value="10">
                                </div>
                                <div class="form-group">
                                    <label for="learning-rate">学习率:</label>
                                    <input type="number" id="learning-rate" min="0.0001" max="0.01" step="0.0001" value="0.001">
                                </div>
                                <div class="form-group">
                                    <label for="batch-size">批次大小:</label>
                                    <input type="number" id="batch-size" min="16" max="256" value="64">
                                </div>
                                <div class="form-group">
                                    <label for="gamma">折扣因子:</label>
                                    <input type="number" id="gamma" min="0.1" max="0.99" step="0.01" value="0.99">
                                </div>
                                
                                <div class="training-buttons">
                                    <button id="btn-start-training" class="btn btn-success">
                                        <i class="fas fa-play"></i> 开始训练
                                    </button>
                                    <button id="btn-stop-training" class="btn btn-danger" disabled>
                                        <i class="fas fa-stop"></i> 停止训练
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="training-charts">
                            <div class="chart-container">
                                <canvas id="reward-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="loss-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="training-stats">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span class="stat-label">当前回合:</span>
                                    <span id="current-episode" class="stat-value">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">平均奖励:</span>
                                    <span id="avg-reward" class="stat-value">0.00</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">成功率:</span>
                                    <span id="success-rate" class="stat-value">0%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">平均损失:</span>
                                    <span id="avg-loss" class="stat-value">0.0000</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 系统日志标签页 -->
                    <div id="tab-log" class="tab-pane">
                        <div class="log-controls">
                            <button id="btn-clear-log" class="btn btn-secondary">
                                <i class="fas fa-trash"></i> 清空日志
                            </button>
                            <button id="btn-save-log" class="btn btn-secondary">
                                <i class="fas fa-download"></i> 保存日志
                            </button>
                            <select id="log-level-filter" class="form-select">
                                <option value="all">所有级别</option>
                                <option value="info">信息</option>
                                <option value="warning">警告</option>
                                <option value="error">错误</option>
                            </select>
                        </div>
                        <div class="log-container">
                            <div id="log-output" class="log-output">
                                <!-- 日志将在这里显示 -->
                            </div>
                        </div>
                    </div>

                    <!-- 系统设置标签页 -->
                    <div id="tab-settings" class="tab-pane">
                        <div class="settings-grid">
                            <div class="settings-section">
                                <h4><i class="fas fa-sliders-h"></i> ROS设置</h4>
                                <div class="form-group">
                                    <label for="ros-master">ROS Master URI:</label>
                                    <input type="text" id="ros-master" value="http://localhost:11311">
                                </div>
                                <div class="form-group">
                                    <label for="ros-ip">ROS IP:</label>
                                    <input type="text" id="ros-ip" value="127.0.0.1">
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4><i class="fas fa-tachometer-alt"></i> 导航设置</h4>
                                <div class="form-group">
                                    <label for="max-linear-speed">最大线速度 (m/s):</label>
                                    <input type="number" id="max-linear-speed" min="0.1" max="2.0" step="0.1" value="0.8">
                                </div>
                                <div class="form-group">
                                    <label for="max-angular-speed">最大角速度 (rad/s):</label>
                                    <input type="number" id="max-angular-speed" min="0.5" max="3.0" step="0.1" value="1.5">
                                </div>
                                <div class="form-group">
                                    <label for="safety-distance">安全距离 (m):</label>
                                    <input type="number" id="safety-distance" min="0.1" max="1.0" step="0.1" value="0.3">
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4><i class="fas fa-eye"></i> 视觉设置</h4>
                                <div class="form-group">
                                    <label for="confidence-threshold">置信度阈值:</label>
                                    <input type="number" id="confidence-threshold" min="0.1" max="0.99" step="0.05" value="0.5">
                                </div>
                                <div class="form-group">
                                    <label for="model-path">模型路径:</label>
                                    <input type="text" id="model-path" value="models/yolov11_apple_best.pt">
                                    <button id="btn-browse-model" class="btn btn-small">浏览</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-buttons">
                            <button id="btn-save-settings" class="btn btn-primary">
                                <i class="fas fa-save"></i> 保存设置
                            </button>
                            <button id="btn-load-settings" class="btn btn-secondary">
                                <i class="fas fa-folder-open"></i> 加载设置
                            </button>
                            <button id="btn-reset-settings" class="btn btn-warning">
                                <i class="fas fa-undo"></i> 重置设置
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部状态栏 -->
        <footer class="app-footer">
            <div class="footer-left">
                <span id="current-time">--:--:--</span>
                <span id="connection-info">未连接</span>
            </div>
            <div class="footer-center">
                <span id="status-message">系统就绪</span>
            </div>
            <div class="footer-right">
                <span>苹果配送机器人系统 v2.0</span>
            </div>
        </footer>
    </div>

    <!-- 隐藏文件输入 -->
    <input type="file" id="file-input" accept="image/*" style="display: none;">
    
    <!-- 模态对话框 -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">提示</h3>
                <button id="modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modal-message">消息内容</p>
            </div>
            <div class="modal-footer">
                <button id="modal-confirm" class="btn btn-primary">确定</button>
                <button id="modal-cancel" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
